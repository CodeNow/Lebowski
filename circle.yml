machine:
  environment:
    NODE_ENV: testing
dependencies:
  override:
    - npm install
    - pip install fabric
    - 'echo "$CIRCLE_BRANCH" | grep -q -w -P "(.*chef.*)|(master)" && bundle check --path=vendor/bundle || bundle install --path=vendor/bundle  --clean':
        pwd: cookbook
        timeout: 99999
test:
  override:
    - npm test
    - 'echo "$CIRCLE_BRANCH" | grep -q -w -P "(.*chef.*)|(master)" && bundle exec rake test':
        pwd: cookbook
        timeout: 99999
  post:
    - cp cookbook/.kitchen/logs/* $CIRCLE_ARTIFACTS

